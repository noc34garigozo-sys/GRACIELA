<!doctype html>
<html lang="es">
<head>
Â  <meta charset="utf-8"/>
Â  <meta name="viewport" content="width=device-width,initial-scale=1"/>
Â  <title>VersÃ­culo â€” Inspirado por ti</title>
Â  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate"/>
Â  <meta http-equiv="Pragma" content="no-cache"/>
Â  <meta http-equiv="Expires" content="0"/>
Â  <style>
Â  Â  html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif; /* --- CAMBIO AQUÃ --- */ background:transparent; /* Antes: #000 */ color:#fff;}
Â  Â  body{display:flex;align-items:center;justify-content:center;min-height:100vh;overflow:hidden;}
Â  Â  .bg{position:fixed;inset:0;z-index:0;background-position:center;background-size:cover;background-repeat:no-repeat;transition:opacity .6s,transform .6s;}
Â  Â  .bg.hidden{opacity:0;transform:scale(1.02);}
Â  Â  /* --- CAMBIO AQUÃ: `z-index` y `background` --- */
Â  Â  .overlay{position:fixed;inset:0;z-index:1; background:none; /* Antes: linear-gradient(...) */}
Â  Â  /* --- Fin Cambios --- */
Â  Â  .wrap{position:relative;z-index:2;max-width:900px;width:100%;padding:30px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;}
Â  Â  .card{width:100%;background:rgba(0,0,0,0.3);border-radius:12px;padding:28px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.6);}
Â  Â  .note{display:inline-block;padding:8px 14px;border-radius:999px;background:linear-gradient(90deg,#ffd89b,#19547b);color:#041018;font-weight:700;margin-bottom:12px;}
Â  Â  .title{font-family:Georgia, 'Times New Roman', serif;font-size:22px;margin:8px 0;}
Â  Â  .verse{font-family:Georgia,serif;font-size:20px;line-height:1.3;margin:12px 6px;opacity:0;transform:translateY(8px);transition:opacity .35s, transform .35s;}
Â  Â  .verse.show{opacity:1;transform:none;}
Â  Â  .ref{margin-top:10px;color:rgba(255,255,255,0.85);font-weight:600;}
Â  Â  .loading{margin-top:10px;color:rgba(255,255,255,0.7);}
Â  Â  @media(max-width:520px){.card{padding:18px}.title{font-size:18px}.verse{font-size:18px}}
Â  </style>
</head>
<body>
Â  <div id="bg1" class="bg"></div>
Â  <div id="bg2" class="bg hidden"></div>
Â  <div class="overlay"></div>

Â  <div class="wrap">
Â  Â  <div class="card" role="main" aria-live="polite">
Â  Â  Â  <div class="note">âœ¨ GRACIELA intentamos aun âœ¨</div>
Â  Â  Â  <div class="title">ğŸ“–</div>
Â  Â  Â  <div id="verse" class="verse">Cargando versÃ­culo...</div>
Â  Â  Â  <div id="ref" class="ref"></div>
Â  Â  Â  <div id="loading" class="loading"></div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  // ---------- URL de tu Apps Script (RESTAURADA A LA VERSIÃ“N FUNCIONAL) ----------
Â  Â  const API_URL = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhNRt3WxUcyhEVuqwXxPJmmpl1Tk5hpm00vm8l5Kj12_Bz5rB4Ss5ienncdlOM0a_yfPujf8LlTLM7XE17dG0IJaNWIu9KSUs-1m-LO0o5IqfjDzuKcOgBLVFl8MlWSAkWwhBbXBFTVM0lwgz6mbKCJvFeBiszLyn36HQWXBCTwhhdD3qyiDDNOZNNxB0P4LRl1Fetl12QLeD3i9xav_-kmqpdN5x0tUt03hRGrUGoyoDzZ6lluCxc6qqpCh3-oSOuhLM5rPEES8JKKBV73AnMni4VTz80_6djbWYsm&lib=MEwd4MNM1mgaZT9U4-GVYSNvTcetvNt65';
Â  Â  // --------------------------------------------------------

Â  Â  // URLs completas de GitHub (estas ya estaban bien)
Â  Â  const backgrounds = [
Â  Â  Â  'https://raw.githubusercontent.com/noc34garigozo-sys/GRACIELA/main/hojaazul.jpg',
Â  Â  Â  'https://raw.githubusercontent.com/noc34garigozo-sys/GRACIELA/main/hojaroja.jpg',
Â  Â  Â  'https://raw.githubusercontent.com/noc34garigozo-sys/GRACIELA/main/hojaverde.jpg'
Â  Â  ];

Â  Â  const bg1 = document.getElementById('bg1');
Â  Â  const bg2 = document.getElementById('bg2');
Â  Â  const verseEl = document.getElementById('verse');
Â  Â  const refEl = document.getElementById('ref');
Â  Â  const loadingEl = document.getElementById('loading');

Â  Â  let showFirst = true;
Â  Â  let lastIndex = -1;

Â  Â  function loadImg(src, timeout = 9000) {
Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  let done = false;
Â  Â  Â  Â  const t = setTimeout(() => { if (!done) { done = true; reject(new Error('timeout')); } }, timeout);
Â  Â  Â  Â  img.onload = () => { if (!done) { done = true; clearTimeout(t); resolve(src); } };
Â  Â  Â  Â  img.onerror = () => { if (!done) { done = true; clearTimeout(t); reject(new Error('error')); } };
Â  Â  Â  Â  // ruta completa; aÃ±adimos cache-bust
Â  Â  Â  Â  img.src = src + '?v=' + Date.now();
Â  Â  Â  });
Â  Â  }

Â  Â  function pickDifferentIndex() {
Â  Â  Â  if (backgrounds.length === 0) return -1;
Â  Â  Â  let i;
Â  Â  Â  do { i = Math.floor(Math.random() * backgrounds.length); }Â 
Â  Â  Â  while (i === lastIndex && backgrounds.length > 1);
Â  Â  Â  lastIndex = i;
Â  Â  Â  return i;
Â  Â  }

Â  Â  async function setBackgroundSafe() {
Â  Â  Â  loadingEl.textContent = 'Cargando imagen...';
Â  Â  Â  const tries = backgrounds.length;
Â  Â  Â  for (let attempt = 0; attempt < tries; attempt++) {
Â  Â  Â  Â  const idx = pickDifferentIndex();
Â  Â  Â  Â  const imgSrc = backgrounds[idx];
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  await loadImg(imgSrc, 8000);
Â  Â  Â  Â  Â  const showEl = showFirst ? bg2 : bg1;
Â  Â  Â  Â  Â  const hideEl = showFirst ? bg1 : bg2;
Â  Â  Â  Â  Â  showEl.style.backgroundImage = `url("${imgSrc}")`;
Â  Â  Â  Â  Â  showEl.classList.remove('hidden');
Â  Â  Â  Â  Â  setTimeout(() => { hideEl.classList.add('hidden'); showFirst = !showFirst; loadingEl.textContent = ''; }, 110);
Â  Â  Â  Â  Â  console.log('Fondo cargado:', imgSrc);
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  console.warn('Fallo imagen, probando otra:', err.message || err, imgSrc);
Â  Â  Â  Â  Â  continue;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  // fallback
Â  Â  Â  loadingEl.textContent = '';
Â  Â  Â  const showEl = showFirst ? bg2 : bg1;
Â  Â  Â  const hideEl = showFirst ? bg1 : bg2;
Â  Â  Â  showEl.style.backgroundImage = 'linear-gradient(120deg,#0f1724,#1e3a8a)';
Â  Â  Â  showEl.classList.remove('hidden');
Â  Â  Â  setTimeout(() => { hideEl.classList.add('hidden'); showFirst = !showFirst; }, 110);
Â  Â  Â  console.warn('No se cargÃ³ ninguna imagen; fallback activo.');
Â  Â  }

Â  Â  async function loadVerseAndBg() {
Â  Â  Â  // primero fondo
Â  Â  Â  await setBackgroundSafe();

Â  Â  Â  // luego versÃ­culo
Â  Â  Â  verseEl.classList.remove('show');
Â  Â  Â  verseEl.textContent = 'Cargando versÃ­culo...';
Â  Â  Â  refEl.textContent = '';
Â  Â  Â  try {
Â  Â  Â  Â  loadingEl.textContent = 'Cargando versÃ­culo...';
Â  Â  Â  Â  const requestUrl = API_URL + (API_URL.includes('?') ? '&' : '?') + '_t=' + Date.now();
Â  Â  Â  Â  console.log('Pidiendo verso a:', requestUrl);
Â  Â  Â  Â  const res = await fetch(requestUrl, { cache: 'no-store' });
Â  Â  Â  Â  console.log('fetch status:', res.status, res.statusText);
Â  Â  Â  Â  // intenta JSON primero
Â  Â  Â  Â  const maybeJson = await res.clone().json().catch(()=>null);
Â  Â  Â  Â  if (maybeJson && maybeJson.verse) {
Â  Â  Â  Â  Â  verseEl.textContent = maybeJson.verse;
Â  Â  Â  Â  Â  refEl.textContent = maybeJson.ref || '';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  // sino, intenta texto plano
Â  Â  Â  Â  Â  const text = await res.text().catch(()=>null);
Â  Â  Â  Â  Â  verseEl.textContent = text || 'No se encontrÃ³ versÃ­culo';
Â  Â  Â  Â  }
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error('Error fetch verso:', err);
Â  Â  Â  Â  verseEl.textContent = 'Error al cargar el versÃ­culo';
Â  Â  Â  } finally {
Â  Â  Â  Â  loadingEl.textContent = '';
Â  Â  Â  Â  setTimeout(() => verseEl.classList.add('show'), 80);
Â  Â  Â  }
Â  Â  }

Â  Â  // arranque rÃ¡pido
Â  Â  (async () => {
Â  Â  Â  try {
Â  Â  Â  Â  const idx = pickDifferentIndex();
Â  Â  Â  Â  await loadImg(backgrounds[idx], 400).then(()=> { bg1.style.backgroundImage = `url("${backgrounds[idx]}")`; }).catch(()=>{/ignore/});
Â  Â  Â  } catch(e){}
Â  Â  Â  loadVerseAndBg();
Â  Â  })();
Â  </script>
</body>
</html>
